<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>钉钉登录</title>
    <style>
#container{
    width: 300px;
    height: 300px;
    position: absolute;
    top: 0px;
    left: 0px;
    right: 0px;
    bottom: 0px;
    margin: auto;
}
    </style>
</head>
<script src="https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js"></script>
<body>
<div id="container"></div>
</body>

<script>
<!--var redirect_uri = encodeURIComponent('http://10.10.121.116/success.html?show=' + getQueryVariable("show"));-->

function getQueryVariable(variable){
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if(pair[0] == variable){return pair[1];}
    }
    return(false);
}

 var obj =  window.DTFrameLogin(
        {
            id: 'container',
            width: 300,
            height: 300,
        },
        {
            redirect_uri:  getQueryVariable("redirect_uri"),
            client_id: getQueryVariable("client_id"),
            scope: getQueryVariable("scope"),
            response_type: 'code',
            state: 'STATE',
            corpId: getQueryVariable("corpId"),
            prompt: 'consent',
        },
        (loginResult) => {
            const {redirectUrl, authCode, state} = loginResult;
            // 这里可以直接进行重定向
            window.location.href = redirectUrl;
            // 也可以在不跳转页面的情况下，使用code进行授权
            console.log(authCode);
<!--                setDingTalkAuth(authCode);-->
        },
        (errorMsg) => {
            // 这里一般需要展示登录失败的具体原因
            alert(`Login Error: ${errorMsg}`);
        },
    );


//设置自动执行
//dom结构绘制完就触发，JQuery写法：$(document).ready(function(){  });
document.addEventListener("DOMContentLoaded", () => {
    setScale();
});
//页面渲染完才触发
<!--window.onload = setScale;-->

//设置横竖屏切换监听
window.addEventListener("orientationchange",function(){
console.log(window.orientation, 'window.orientation')
    setScale()
});

function setScale() {
    var platform = getQueryVariable("platform")
    if(platform == "android"){
        //android平台
        var device = getQueryVariable("device")
        if(device == "pda"){
            setScaleForSmallAndroid()
        } else {
            setScaleForAndroid()
        }
    } else {
        //iOS
        setScaleForIOS()
    }
}

//设置iOS设备横竖屏的缩放倍率
function setScaleForIOS() {
    var element = document.getElementById("container");
    var scale = 1;
    //横竖屏角度判断存在部分设备强制竖屏也用横屏显示，因此用屏幕宽高来判断
    if (window.orientation == 0 || window.orientation == 180){
        //竖屏
        scale = 2;
    } else {
        //横屏 90 和 - 90
        scale = 1.2;
    }

<!--    alert("width: " + window.screen.width + " , height: " + window.screen.height + " , window.orientation: " + window.orientation);-->
    element.style.transform = "scale("+ scale +")";
}

//设置Android设备横竖屏的缩放倍率
function setScaleForAndroid() {
    var element = document.getElementById("container");
    var scale = 1;
    //横竖屏角度判断存在部分设备强制竖屏也用横屏显示，因此用屏幕宽高来判断
    if (window.screen.width >= window.screen.height){
        //横屏
        scale = 1;
    } else {
        //竖屏
        scale = 2;
    }
    element.style.transform = "scale("+ scale +")";
}

//设置Android PDA小屏设备横竖屏的缩放倍率
function setScaleForSmallAndroid() {
    var element = document.getElementById("container");
    var scale = window.innerWidth * 1.0 / 250;
    element.style.transform = "scale("+ scale +")";
}



<!--    以下JS桥部分     -->

//钉钉临时授权码
function setDingTalkAuth(auth) {
    try {
        bridge.callNative("setDingTalkAuth", auth);
    } catch (ex) {
    }
}

var requestData = {
    nativeConfig: {},
    nativeRequest: {}
};

var nativeConfig = {
    nativeCallName: "",
    requestId: "",
    timeStamp: 0,
    nativeCallType: "request"
};

/* 注册JS桥，默认桥名：WebViewJavascriptBridge */
var kkGroupJSBridge = function (callback) {
    try {
        if (window.WebViewJavascriptBridge) {
            callback(WebViewJavascriptBridge);
        } else {
            document.addEventListener("WebViewJavascriptBridgeReady", function () {
                callback(WebViewJavascriptBridge);
            }, false);
        }
    } catch (ex) {
    }
};

/*
 * JS 调用app native方法
 *
 * @param nativeCallName 请求nativeCallName
 * @param data 数据实体
 */
var bridge = {
    callNative: function (nativeCallName, data) {
        nativeConfig.nativeCallName = nativeCallName;
        nativeConfig.requestId = "请求Id";
        nativeConfig.timeStamp = new Date().getTime();

        requestData.nativeConfig = nativeConfig;

        if (!data) {
            //设置一个空实体
            requestData.nativeRequest = {};
        } else {
            requestData.nativeRequest = data;
        }

        kkGroupJSBridge(function (bridge) {
            if (typeof bridge === "undefined") {
                return;
            }
            bridge.callHandler("nativeRequest", JSON.stringify(requestData));
        });
    },
};

/* app native调用 JS 方法 */
kkGroupJSBridge(function (bridge) {
    bridge.init(function (message, responseCallback) {
});

/* 注册nativeResponse，app native 通过nativeResponse调用 JS */
bridge.registerHandler("nativeResponse", function (data, responseCallback) {
    /* 这里执行相关处理 */
    var request = JSON.parse(data);
    var nativeConfig =  request.nativeConfig;

    if ("chooseMedia" == nativeConfig.nativeCallName){
        //示例
<!--        responseCallback("这里可以返回数据：" + data);-->
    }
});

bridge.registerHandler("nativeCall", function (data, responseCallback) {
<!--    showToast(data, 2000);-->
<!--    responseCallback("这里可以返回数据");-->
    });
});

/* 显示一个toast */
function showToast(msg, duration){
    duration=isNaN(duration)?3000:duration;
    var m = document.createElement('div');
    m.innerHTML = msg;
    m.style.cssText="max-width:60%;min-width: 150px;padding:0 14px;max-height:60%;min-height: 40px;color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);z-index: 9999999999;background: rgba(0, 0, 0,.7);font-size: 30px;";
    document.body.appendChild(m);
    setTimeout(function() {
        var d = 0.5;
        m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
        m.style.opacity = '0';
        setTimeout(function() { document.body.removeChild(m) }, d * 1000);
    }, duration);
}
</script>
</html>