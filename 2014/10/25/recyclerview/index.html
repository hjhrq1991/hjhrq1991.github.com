<!DOCTYPE html>
          <head>
        <meta charset="utf-8">
            
            <title>
                Android5.0之RecyclerView | 猪生-秋仔
            </title>
            <meta content="width=device-width, initial-scale=1" name="viewport">
            <meta name="theme-color" content="#4184f3">
            
            <link href="/atom.xml" rel="alternate" title="猪生-秋仔" type="application/atom+xml"/>
            
            
            <link href="/favicon.ico" rel="icon"/>
            

            <link rel="stylesheet" href="/css/highlight.light.css">
            <link rel="stylesheet" href="/css/prism-customize.css">
            <link rel="stylesheet" href="/css/nav-icon.css">
            <link rel="stylesheet" href="/css/waves.min.css">
            <link rel="stylesheet" href="/css/jquery.tocify.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/nav-indicator.css">
            
  
  <!-- 百度统计 -->
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?a0050566dc0cebfb5baa4fa25f557a59";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  

  
            </meta>
        </meta>
    </head>

    <body>
        <header>
            <!-- cover image or sth. -->
        </header>
        <div id="main" class="m-scene">
            
<div class="nav-wrapper">

    <div class="container">
        <nav>
            <div class="logo wave">
                <a href="/" id="logo">
                    猪生-秋仔
                </a>
            </div>
            <div class="nav-toggle-icon" >
                <div class="material-hamburger">
                    <span>
                    </span>
                    <span>
                    </span>
                    <span>
                    </span>
                </div>
            </div>
            <div class="menu-wrapper">
                <div class="nav-indicator">
                </div>
                <ul class="menus">
                    
                     
                        <li>
                            <a class="wave " href="/">
                                首页
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave " href="/archives">
                                归档
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave " href="/about">
                                关于
                            </a>
                        </li>
                     
                    
                   
                </ul>
            </div>
        </nav>
    </div>
</div>
            <div class="container content">
                <div class="scene_element scene_element--fadein">
                    <div class="row">
    <div class="main">
        <article>
            <h1>
                Android5.0之RecyclerView 
            </h1>
            <small>2014/10/25</small>
            <p>在上一篇Blog中已经讲到过了RecyclerVIew的特性等等，现在我们开始正式讲讲这个它吧。<br>RecyclerView作为listview的更新版面世，有着他得天独厚的优势：<br>第一点，就是他更完善Recycler机制，比listview的recycler机制还相对完善，可以指定recycler缓冲池中循环利用的view的数量；<br>第二点，recyclerview不再有由自己来管理子布局view了，全部交给layoutmanger管理；<br>第三点，完美解决了循环和滚动的问题，而且支持横向布局；<br>第四点，支持item动画，猿们终于不用自己写很多代码去对item设置动画，懒点可以使用默认动画，想炫点可以自己自定义动画并通过setItemAnimator()方法设置……<br>好了，不多说，优势还有很多，就让猿们自己慢慢挖掘吧。</p>
<p>recyclerview是21新增的widget，想使用的话，需要使用以下最新的support-v7-21包，以及recyclerview的单独支持包。这两个包都可以在最新的SDK中提取出来，使用jar包或者工程都可以。</p>
<p style="text-align:center"><br><img src="/img/RecyclerView/RecyclerView1.png" width="60%" height="60%"><br></p>

<p>导入包后我们就可以开始使用recyclerview了，在布局文件中使用方法如下。Eclipse中是无法找到的，只能自己手动把android.support.v7.widget.RecyclerView打出来，在AS上可以直接找到。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;android.support.v7.widget.RecyclerView</div><div class="line">    android:id=&quot;@+id/rvlist&quot;</div><div class="line">    android:layout_below=&quot;@+id/title_bar&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:scrollbars=&quot;none&quot; /&gt;</div></pre></td></tr></table></figure></p>
<p>布局有了，item的布局我就不说，下面跟随我的步伐看看代码里怎么使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">private void showDate() &#123;</div><div class="line">    // 创建一个线性布局管理器</div><div class="line">    LinearLayoutManager layoutManager = new LinearLayoutManager(this);</div><div class="line">    // 设置垂直布局，目前仅支持LinearLayout(有垂直和横向)</div><div class="line">    layoutManager.setOrientation(LinearLayoutManager.VERTICAL);</div><div class="line">    // 设置缓冲池最大循环使用view数</div><div class="line">    mRecylerView.getRecycledViewPool().setMaxRecycledViews(0, 10);</div><div class="line">    // 设置布局管理器</div><div class="line">    mRecylerView.setLayoutManager(layoutManager);</div><div class="line">    // 创建Adapter，并指定数据集</div><div class="line">    mAdapter = new TestAdaper(this, mList);</div><div class="line">    // 设置Adapter</div><div class="line">    mRecylerView.setAdapter(mAdapter);</div><div class="line">    // 设置默认动画</div><div class="line">    mRecylerView.setItemAnimator(new DefaultItemAnimator());</div><div class="line">    // 还有下面这上三种动画FlipDownItemAnimator, SlideItemAnimator, FromTopItemAnimator</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adapter的变化更是大，recyclerview的adapter使用viewholder，使用时必须继承RecyclerView.Adapter；在listview中，我们使用getview()来获取item的布局，在这里我们必须使用onCreateViewHolder(ViewGroup parent, int viewtype)来获取布局，其中第二个参数viewtype怎么来的？其实是我们传进来的，如果我们需要使用多布局，则必须复写getItemViewType方法，这个方法没有强制必须复写，但是多布局时必须复写，这是个int返回值得方法，我们将你的布局类型传进去，这样我们就可以得到viewtype。另外，viewholder的使用必须继承RecyclerView.ViewHolder。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line">package com.hjhrq1991.adapter;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">import com.hjhrq1991.bean.TestInfo;</div><div class="line">import com.hjhrq1991.recyclerviewdemo.R;</div><div class="line"></div><div class="line">import android.content.Context;</div><div class="line">import android.support.v7.widget.RecyclerView;</div><div class="line">import android.support.v7.widget.RecyclerView.ViewHolder;</div><div class="line">import android.view.LayoutInflater;</div><div class="line">import android.view.View;</div><div class="line">import android.view.ViewGroup;</div><div class="line">import android.widget.CheckBox;</div><div class="line">import android.widget.ImageView;</div><div class="line">import android.widget.TextView;</div><div class="line">import android.widget.Toast;</div><div class="line"></div><div class="line">public class TestAdaper extends RecyclerView.Adapter&lt;ViewHolder&gt; &#123;</div><div class="line">    private List&lt;TestInfo&gt; mList;</div><div class="line">    private Context context;</div><div class="line"></div><div class="line">    public TestAdaper(Context context, List&lt;TestInfo&gt; mList) &#123;</div><div class="line">        super();</div><div class="line">        this.context = context;</div><div class="line">        this.mList = mList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 内部TextHoler</div><div class="line">     */</div><div class="line">    public class TextHoler extends RecyclerView.ViewHolder &#123;</div><div class="line">        public TextView textView;</div><div class="line"></div><div class="line">        public TextHoler(View view) &#123;</div><div class="line">            super(view);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * iamgeHolder</div><div class="line">     */</div><div class="line">    public class ImageHoler extends RecyclerView.ViewHolder &#123;</div><div class="line">        public TextView textView;</div><div class="line">        public ImageView Imageview;</div><div class="line"></div><div class="line">        public ImageHoler(View view) &#123;</div><div class="line">            super(view);</div><div class="line">            this.textView = (TextView) view.findViewById(R.id.text);</div><div class="line">            this.Imageview = (ImageView) view.findViewById(R.id.image);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 按钮的holder</div><div class="line">     */</div><div class="line">    public class CbHoler extends RecyclerView.ViewHolder &#123;</div><div class="line">        public TextView textView;</div><div class="line">        public ImageView Imageview;</div><div class="line">        public CheckBox checkbox;</div><div class="line"></div><div class="line">        public CbHoler(View view) &#123;</div><div class="line">            super(view);</div><div class="line">            this.textView = (TextView) view.findViewById(R.id.text);</div><div class="line">            this.Imageview = (ImageView) view.findViewById(R.id.image);</div><div class="line">            this.checkbox = (CheckBox) view.findViewById(R.id.checkbox);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getItemCount() &#123;</div><div class="line">        // TODO Auto-generated method stub</div><div class="line">        return mList.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 获取item的类型</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public int getItemViewType(int position) &#123;</div><div class="line">        // TODO Auto-generated method stub</div><div class="line">        return mList.get(position).getType();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 创建view</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewtype) &#123;</div><div class="line">        // TODO Auto-generated method stub</div><div class="line">        View v = null;</div><div class="line">        ViewHolder holer = null;</div><div class="line">        switch (viewtype) &#123;</div><div class="line">            case TestInfo.TASK_TEXT:</div><div class="line">                v = LayoutInflater.from(parent.getContext()).inflate(</div><div class="line">                    R.layout.item_text_layout, null);</div><div class="line">                holer = new TextHoler(v);</div><div class="line">                break;</div><div class="line">            case TestInfo.TASK_DRAWABLE:</div><div class="line">                v = LayoutInflater.from(parent.getContext()).inflate(</div><div class="line">                    R.layout.item_image_layout, null);</div><div class="line">                holer = new ImageHoler(v);</div><div class="line">                break;</div><div class="line">            case TestInfo.TASK_CHEXKBOX:</div><div class="line">                v = LayoutInflater.from(parent.getContext()).inflate(</div><div class="line">                    R.layout.item_checkbox_layout, null);</div><div class="line">                holer = new CbHoler(v);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return holer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 在这里进行数据的绑定，参数1是onCreateViewHolder创建的viewholder，参数2是你item的位置</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public void onBindViewHolder(ViewHolder holder, int position) &#123;</div><div class="line">        // TODO Auto-generated method stub</div><div class="line">        switch (getItemViewType(position)) &#123;</div><div class="line">            case TestInfo.TASK_TEXT:</div><div class="line">                TextHoler textholer = (TextHoler) holder;</div><div class="line">                textholer.textView.setText(mList.get(position).getContent());</div><div class="line">                break;</div><div class="line">            case TestInfo.TASK_DRAWABLE:</div><div class="line">                ImageHoler imageHolder = (ImageHoler) holder;</div><div class="line">                imageHolder.textView.setText(mList.get(position).getContent());</div><div class="line">                imageHolder.Imageview.setImageResource(mList.get(position)</div><div class="line">                    .getDrawableurl());</div><div class="line">                break;</div><div class="line">            case TestInfo.TASK_CHEXKBOX:</div><div class="line">                CbHoler cbHoler = (CbHoler) holder;</div><div class="line">                cbHoler.textView.setText(mList.get(position).getContent());</div><div class="line">                cbHoler.Imageview.setImageResource(mList.get(position)</div><div class="line">                    .getDrawableurl());</div><div class="line">                cbHoler.checkbox.setText(mList.get(position).getCbcontent());</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看了这么多代码，估计猿们纷纷表示，click方法呢？怎么没见到onitemclick方法？是的，listview里有onItemClick方法，但是这样容易造成item和item内部控件的点击事件冲突，为了解决这个问题，recyclerview不再提供onitemclick方法。惊恐纳尼，不提供，那怎么破？别担心，onitemclick方法可以在adapter中实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * item点击事件的实现</div><div class="line"> */</div><div class="line">class OnItemClick implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">    public OnItemClick() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        Toast.makeText(context, &quot;你点击了item&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * item内部控件点击事件的实现</div><div class="line"> */</div><div class="line">class OnClick implements View.OnClickListener &#123;</div><div class="line">    private int position;</div><div class="line"></div><div class="line">    public OnClick(int position) &#123;</div><div class="line">        this.position = position;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        Toast.makeText(context, &quot;你点击了第&quot; + position + &quot;个text&quot;,</div><div class="line">            Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>onItemClick方法在ViewHolder里使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class TextHoler extends RecyclerView.ViewHolder &#123;</div><div class="line">    public TextView textView;</div><div class="line"></div><div class="line">    public TextHoler(View view) &#123;</div><div class="line">        super(view);</div><div class="line">        this.textView = (TextView) view.findViewById(R.id.text);</div><div class="line">        view.setOnClickListener(new OnItemClick());// 这里使用onItemClick方法</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>至于item内部控件的点击事件在onBindViewHolder方法里实现。<br>除了这种方法可以实现onItemClick事件外，还有其他方法，例如在复写recyclerview源码，扩展他的点击事件方法。我自己还有另一种方法，在adapter里写一个接口，在activity里实现接口并监听接口，这种方法就在我下一篇blog使用recyclerview实现Gallery画廊效果里说吧。</p>
<p style="text-align:center"><br><img src="/img/RecyclerView/RecyclerView2.jpeg" width="60%" height="60%"><br></p>

<p><a href="http://download.csdn.net/detail/hjhrq1991/8093009" target="_blank" rel="external">demo下载</a></p>

        </article>
        <div class="comment-section">
  
    

    <!-- 多说评论框 start -->
      <div class="ds-thread" data-thread-key="_posts/recyclerview.md" data-title="Android5.0之RecyclerView" data-url="http://yoursite.com/2014/10/25/recyclerview/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"hjhrq1991"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->

  


</div>
    </div>
</div>

                </div>
            </div>
        </div>
        <footer class="footer">
    <p>由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动，搭载<a href="https://github.com/wayou/hexo-theme-gstyle">gstyle</a>主题</p>
    <p>
        &copy; 2016 John Doe
    </p>
</footer>
<script src="/lib/jquery.js"></script>
<script src="/lib/waves.js"></script>
<script src="/lib/jquery-ui.js"></script>
<script src="/lib/jquery.tocify.js"></script>
<script src="/js/main.js"></script>

    </body>
</html>
